{"ast":null,"code":"'use strict';\n\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return typeof key === \"symbol\" ? key : String(key);\n}\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nimport { isChromeDebugger, isJest, isWeb, isWindowAvailable } from '../PlatformChecker';\nimport { SensorType } from '../commonTypes';\nimport { mockedRequestAnimationFrame } from '../mockedRequestAnimationFrame';\nvar requestAnimationFrameImpl = isJest() || !globalThis.requestAnimationFrame ? mockedRequestAnimationFrame : globalThis.requestAnimationFrame;\nvar JSReanimated = function () {\n  function JSReanimated() {\n    var _this = this;\n    _classCallCheck(this, JSReanimated);\n    _defineProperty(this, \"nextSensorId\", 0);\n    _defineProperty(this, \"sensors\", new Map());\n    _defineProperty(this, \"platform\", undefined);\n    _defineProperty(this, \"getSensorCallback\", function (sensor, sensorType, eventHandler) {\n      switch (sensorType) {\n        case SensorType.ACCELEROMETER:\n        case SensorType.GRAVITY:\n          return function () {\n            var x = sensor.x,\n              y = sensor.y,\n              z = sensor.z;\n            if (_this.platform === Platform.WEB_ANDROID) {\n              var _ref2 = [-x, -y, -z];\n              x = _ref2[0];\n              y = _ref2[1];\n              z = _ref2[2];\n            }\n            eventHandler({\n              x: x,\n              y: y,\n              z: z,\n              interfaceOrientation: 0\n            });\n          };\n        case SensorType.GYROSCOPE:\n        case SensorType.MAGNETIC_FIELD:\n          return function () {\n            var x = sensor.x,\n              y = sensor.y,\n              z = sensor.z;\n            eventHandler({\n              x: x,\n              y: y,\n              z: z,\n              interfaceOrientation: 0\n            });\n          };\n        case SensorType.ROTATION:\n          return function () {\n            var _sensor$quaternion = _slicedToArray(sensor.quaternion, 4),\n              qw = _sensor$quaternion[0],\n              qx = _sensor$quaternion[1],\n              qy = _sensor$quaternion[2],\n              qz = _sensor$quaternion[3];\n            if (_this.platform === Platform.WEB_ANDROID) {\n              var _ref3 = [qz, -qy];\n              qy = _ref3[0];\n              qz = _ref3[1];\n            }\n            var yaw = -Math.atan2(2.0 * (qy * qz + qw * qx), qw * qw - qx * qx - qy * qy + qz * qz);\n            var pitch = Math.sin(-2.0 * (qx * qz - qw * qy));\n            var roll = -Math.atan2(2.0 * (qx * qy + qw * qz), qw * qw + qx * qx - qy * qy - qz * qz);\n            eventHandler({\n              qw: qw,\n              qx: qx,\n              qy: qy,\n              qz: qz,\n              yaw: yaw,\n              pitch: pitch,\n              roll: roll,\n              interfaceOrientation: 0\n            });\n          };\n      }\n    });\n  }\n  _createClass(JSReanimated, [{\n    key: \"makeShareableClone\",\n    value: function makeShareableClone() {\n      throw new Error('[Reanimated] makeShareableClone should never be called in JSReanimated.');\n    }\n  }, {\n    key: \"scheduleOnUI\",\n    value: function scheduleOnUI(worklet) {\n      requestAnimationFrameImpl(worklet);\n    }\n  }, {\n    key: \"createWorkletRuntime\",\n    value: function createWorkletRuntime(_name, _initializer) {\n      throw new Error('[Reanimated] createWorkletRuntime is not available in JSReanimated.');\n    }\n  }, {\n    key: \"scheduleOnRuntime\",\n    value: function scheduleOnRuntime() {\n      throw new Error('[Reanimated] scheduleOnRuntime is not available in JSReanimated.');\n    }\n  }, {\n    key: \"registerEventHandler\",\n    value: function registerEventHandler(_eventHandler, _eventName, _emitterReactTag) {\n      return -1;\n    }\n  }, {\n    key: \"unregisterEventHandler\",\n    value: function unregisterEventHandler(_) {}\n  }, {\n    key: \"enableLayoutAnimations\",\n    value: function enableLayoutAnimations() {\n      if (isWeb()) {\n        console.warn('[Reanimated] Layout Animations are not supported on web yet.');\n      } else if (isJest()) {\n        console.warn('[Reanimated] Layout Animations are no-ops when using Jest.');\n      } else if (isChromeDebugger()) {\n        console.warn('[Reanimated] Layout Animations are no-ops when using Chrome Debugger.');\n      } else {\n        console.warn('[Reanimated] Layout Animations are not supported on this configuration.');\n      }\n    }\n  }, {\n    key: \"configureLayoutAnimation\",\n    value: function configureLayoutAnimation() {}\n  }, {\n    key: \"setShouldAnimateExitingForTag\",\n    value: function setShouldAnimateExitingForTag() {}\n  }, {\n    key: \"registerSensor\",\n    value: function registerSensor(sensorType, interval, _iosReferenceFrame, eventHandler) {\n      if (!isWindowAvailable()) {\n        return -1;\n      }\n      if (this.platform === undefined) {\n        this.detectPlatform();\n      }\n      if (!(this.getSensorName(sensorType) in window)) {\n        console.warn('[Reanimated] Sensor is not available.' + (isWeb() && location.protocol !== 'https:' ? ' Make sure you use secure origin with `npx expo start --web --https`.' : '') + (this.platform === Platform.WEB_IOS ? ' For iOS web, you will also have to also grant permission in the browser: https://dev.to/li/how-to-requestpermission-for-devicemotion-and-deviceorientation-events-in-ios-13-46g2.' : ''));\n        return -1;\n      }\n      if (this.platform === undefined) {\n        this.detectPlatform();\n      }\n      var sensor = this.initializeSensor(sensorType, interval);\n      sensor.addEventListener('reading', this.getSensorCallback(sensor, sensorType, eventHandler));\n      sensor.start();\n      this.sensors.set(this.nextSensorId, sensor);\n      return this.nextSensorId++;\n    }\n  }, {\n    key: \"unregisterSensor\",\n    value: function unregisterSensor(id) {\n      var sensor = this.sensors.get(id);\n      if (sensor !== undefined) {\n        sensor.stop();\n        this.sensors.delete(id);\n      }\n    }\n  }, {\n    key: \"subscribeForKeyboardEvents\",\n    value: function subscribeForKeyboardEvents(_) {\n      if (isWeb()) {\n        console.warn('[Reanimated] useAnimatedKeyboard is not available on web yet.');\n      } else if (isJest()) {\n        console.warn('[Reanimated] useAnimatedKeyboard is not available when using Jest.');\n      } else if (isChromeDebugger()) {\n        console.warn('[Reanimated] useAnimatedKeyboard is not available when using Chrome Debugger.');\n      } else {\n        console.warn('[Reanimated] useAnimatedKeyboard is not available on this configuration.');\n      }\n      return -1;\n    }\n  }, {\n    key: \"unsubscribeFromKeyboardEvents\",\n    value: function unsubscribeFromKeyboardEvents(_) {}\n  }, {\n    key: \"initializeSensor\",\n    value: function initializeSensor(sensorType, interval) {\n      var config = interval <= 0 ? {\n        referenceFrame: 'device'\n      } : {\n        frequency: 1000 / interval\n      };\n      switch (sensorType) {\n        case SensorType.ACCELEROMETER:\n          return new window.Accelerometer(config);\n        case SensorType.GYROSCOPE:\n          return new window.Gyroscope(config);\n        case SensorType.GRAVITY:\n          return new window.GravitySensor(config);\n        case SensorType.MAGNETIC_FIELD:\n          return new window.Magnetometer(config);\n        case SensorType.ROTATION:\n          return new window.AbsoluteOrientationSensor(config);\n      }\n    }\n  }, {\n    key: \"getSensorName\",\n    value: function getSensorName(sensorType) {\n      switch (sensorType) {\n        case SensorType.ACCELEROMETER:\n          return 'Accelerometer';\n        case SensorType.GRAVITY:\n          return 'GravitySensor';\n        case SensorType.GYROSCOPE:\n          return 'Gyroscope';\n        case SensorType.MAGNETIC_FIELD:\n          return 'Magnetometer';\n        case SensorType.ROTATION:\n          return 'AbsoluteOrientationSensor';\n      }\n    }\n  }, {\n    key: \"detectPlatform\",\n    value: function detectPlatform() {\n      var userAgent = navigator.userAgent || navigator.vendor || window.opera;\n      if (userAgent === undefined) {\n        this.platform = Platform.UNKNOWN;\n      } else if (/iPad|iPhone|iPod/.test(userAgent)) {\n        this.platform = Platform.WEB_IOS;\n      } else if (/android/i.test(userAgent)) {\n        this.platform = Platform.WEB_ANDROID;\n      } else {\n        this.platform = Platform.WEB;\n      }\n    }\n  }, {\n    key: \"makeSynchronizedDataHolder\",\n    value: function makeSynchronizedDataHolder(_valueRef) {\n      throw new Error('[Reanimated] makeSynchronizedDataHolder is not available in JSReanimated.');\n    }\n  }, {\n    key: \"getDataSynchronously\",\n    value: function getDataSynchronously(_ref) {\n      throw new Error('[Reanimated] getDataSynchronously is not available in JSReanimated.');\n    }\n  }, {\n    key: \"getViewProp\",\n    value: function getViewProp(_viewTag, _propName, _callback) {\n      throw new Error('[Reanimated] getViewProp is not available in JSReanimated.');\n    }\n  }, {\n    key: \"configureProps\",\n    value: function configureProps() {\n      throw new Error('[Reanimated] configureProps is not available in JSReanimated.');\n    }\n  }]);\n  return JSReanimated;\n}();\nexport { JSReanimated as default };\nvar Platform = function (Platform) {\n  Platform[\"WEB_IOS\"] = \"web iOS\";\n  Platform[\"WEB_ANDROID\"] = \"web Android\";\n  Platform[\"WEB\"] = \"web\";\n  Platform[\"UNKNOWN\"] = \"unknown\";\n  return Platform;\n}(Platform || {});","map":{"version":3,"sources":["JSReanimated.ts"],"names":["isChromeDebugger","isJest","isWeb","isWindowAvailable","SensorType","mockedRequestAnimationFrame","requestAnimationFrameImpl","globalThis","requestAnimationFrame","JSReanimated","constructor","_defineProperty","Map","undefined","makeShareableClone","Error","scheduleOnUI","worklet","createWorkletRuntime","_name","_initializer","scheduleOnRuntime","registerEventHandler","_eventHandler","_eventName","_emitterReactTag","unregisterEventHandler","_","enableLayoutAnimations","console","warn","configureLayoutAnimation","setShouldAnimateExitingForTag","registerSensor","sensorType","interval","_iosReferenceFrame","eventHandler","platform","detectPlatform","getSensorName","window","location","protocol","Platform","WEB_IOS","sensor","initializeSensor","addEventListener","getSensorCallback","start","sensors","set","nextSensorId","ACCELEROMETER","GRAVITY","x","y","z","WEB_ANDROID","interfaceOrientation","GYROSCOPE","MAGNETIC_FIELD","ROTATION","qw","qx","qy","qz","quaternion","yaw","Math","atan2","pitch","sin","roll","unregisterSensor","id","get","stop","delete","subscribeForKeyboardEvents","unsubscribeFromKeyboardEvents","config","referenceFrame","frequency","Accelerometer","Gyroscope","GravitySensor","Magnetometer","AbsoluteOrientationSensor","userAgent","navigator","vendor","opera","UNKNOWN","test","WEB","makeSynchronizedDataHolder","_valueRef","getDataSynchronously","_ref","getViewProp","_viewTag","_propName","_callback","configureProps"],"mappings":"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","sourcesContent":["'use strict';\nimport {\n  isChromeDebugger,\n  isJest,\n  isWeb,\n  isWindowAvailable,\n} from '../PlatformChecker';\nimport type {\n  ShareableRef,\n  ShareableSyncDataHolderRef,\n  Value3D,\n  ValueRotation,\n} from '../commonTypes';\nimport { SensorType } from '../commonTypes';\nimport type { WebSensor } from './WebSensor';\nimport { mockedRequestAnimationFrame } from '../mockedRequestAnimationFrame';\nimport type { WorkletRuntime } from '../runtimes';\n\n// In Node.js environments (like when static rendering with Expo Router)\n// requestAnimationFrame is unavailable, so we use our mock.\n// It also has to be mocked for Jest purposes (see `initializeUIRuntime`).\nconst requestAnimationFrameImpl =\n  isJest() || !globalThis.requestAnimationFrame\n    ? mockedRequestAnimationFrame\n    : globalThis.requestAnimationFrame;\n\nexport default class JSReanimated {\n  nextSensorId = 0;\n  sensors = new Map<number, WebSensor>();\n  platform?: Platform = undefined;\n\n  makeShareableClone<T>(): ShareableRef<T> {\n    throw new Error(\n      '[Reanimated] makeShareableClone should never be called in JSReanimated.'\n    );\n  }\n\n  scheduleOnUI<T>(worklet: ShareableRef<T>) {\n    // @ts-ignore web implementation has still not been updated after the rewrite, this will be addressed once the web implementation updates are ready\n    requestAnimationFrameImpl(worklet);\n  }\n\n  createWorkletRuntime(\n    _name: string,\n    _initializer: ShareableRef<() => void>\n  ): WorkletRuntime {\n    throw new Error(\n      '[Reanimated] createWorkletRuntime is not available in JSReanimated.'\n    );\n  }\n\n  scheduleOnRuntime() {\n    throw new Error(\n      '[Reanimated] scheduleOnRuntime is not available in JSReanimated.'\n    );\n  }\n\n  registerEventHandler<T>(\n    _eventHandler: ShareableRef<T>,\n    _eventName: string,\n    _emitterReactTag: number\n  ): number {\n    // noop\n    return -1;\n  }\n\n  unregisterEventHandler(_: number): void {\n    // noop\n  }\n\n  enableLayoutAnimations() {\n    if (isWeb()) {\n      console.warn(\n        '[Reanimated] Layout Animations are not supported on web yet.'\n      );\n    } else if (isJest()) {\n      console.warn(\n        '[Reanimated] Layout Animations are no-ops when using Jest.'\n      );\n    } else if (isChromeDebugger()) {\n      console.warn(\n        '[Reanimated] Layout Animations are no-ops when using Chrome Debugger.'\n      );\n    } else {\n      console.warn(\n        '[Reanimated] Layout Animations are not supported on this configuration.'\n      );\n    }\n  }\n\n  configureLayoutAnimation() {\n    // no-op\n  }\n\n  setShouldAnimateExitingForTag() {\n    // no-op\n  }\n\n  registerSensor(\n    sensorType: SensorType,\n    interval: number,\n    _iosReferenceFrame: number,\n    eventHandler: ShareableRef<(data: Value3D | ValueRotation) => void>\n  ): number {\n    if (!isWindowAvailable()) {\n      // the window object is unavailable when building the server portion of a site that uses SSG\n      // this check is here to ensure that the server build won't fail\n      return -1;\n    }\n\n    if (this.platform === undefined) {\n      this.detectPlatform();\n    }\n\n    if (!(this.getSensorName(sensorType) in window)) {\n      // https://w3c.github.io/sensors/#secure-context\n      console.warn(\n        '[Reanimated] Sensor is not available.' +\n          (isWeb() && location.protocol !== 'https:'\n            ? ' Make sure you use secure origin with `npx expo start --web --https`.'\n            : '') +\n          (this.platform === Platform.WEB_IOS\n            ? ' For iOS web, you will also have to also grant permission in the browser: https://dev.to/li/how-to-requestpermission-for-devicemotion-and-deviceorientation-events-in-ios-13-46g2.'\n            : '')\n      );\n      return -1;\n    }\n\n    if (this.platform === undefined) {\n      this.detectPlatform();\n    }\n\n    const sensor: WebSensor = this.initializeSensor(sensorType, interval);\n    sensor.addEventListener(\n      'reading',\n      this.getSensorCallback(sensor, sensorType, eventHandler)\n    );\n    sensor.start();\n\n    this.sensors.set(this.nextSensorId, sensor);\n    return this.nextSensorId++;\n  }\n\n  getSensorCallback = (\n    sensor: WebSensor,\n    sensorType: SensorType,\n    eventHandler: ShareableRef<(data: Value3D | ValueRotation) => void>\n  ) => {\n    switch (sensorType) {\n      case SensorType.ACCELEROMETER:\n      case SensorType.GRAVITY:\n        return () => {\n          let { x, y, z } = sensor;\n\n          // Web Android sensors have a different coordinate system than iOS\n          if (this.platform === Platform.WEB_ANDROID) {\n            [x, y, z] = [-x, -y, -z];\n          }\n          // TODO TYPESCRIPT on web ShareableRef is the value itself so we call it directly\n          (eventHandler as any)({ x, y, z, interfaceOrientation: 0 });\n        };\n      case SensorType.GYROSCOPE:\n      case SensorType.MAGNETIC_FIELD:\n        return () => {\n          const { x, y, z } = sensor;\n          // TODO TYPESCRIPT on web ShareableRef is the value itself so we call it directly\n          (eventHandler as any)({ x, y, z, interfaceOrientation: 0 });\n        };\n      case SensorType.ROTATION:\n        return () => {\n          let [qw, qx, qy, qz] = sensor.quaternion;\n\n          // Android sensors have a different coordinate system than iOS\n          if (this.platform === Platform.WEB_ANDROID) {\n            [qy, qz] = [qz, -qy];\n          }\n\n          // reference: https://stackoverflow.com/questions/5782658/extracting-yaw-from-a-quaternion\n          const yaw = -Math.atan2(\n            2.0 * (qy * qz + qw * qx),\n            qw * qw - qx * qx - qy * qy + qz * qz\n          );\n          const pitch = Math.sin(-2.0 * (qx * qz - qw * qy));\n          const roll = -Math.atan2(\n            2.0 * (qx * qy + qw * qz),\n            qw * qw + qx * qx - qy * qy - qz * qz\n          );\n          // TODO TYPESCRIPT on web ShareableRef is the value itself so we call it directly\n          (eventHandler as any)({\n            qw,\n            qx,\n            qy,\n            qz,\n            yaw,\n            pitch,\n            roll,\n            interfaceOrientation: 0,\n          });\n        };\n    }\n  };\n\n  unregisterSensor(id: number): void {\n    const sensor: WebSensor | undefined = this.sensors.get(id);\n    if (sensor !== undefined) {\n      sensor.stop();\n      this.sensors.delete(id);\n    }\n  }\n\n  subscribeForKeyboardEvents(_: ShareableRef<number>): number {\n    if (isWeb()) {\n      console.warn(\n        '[Reanimated] useAnimatedKeyboard is not available on web yet.'\n      );\n    } else if (isJest()) {\n      console.warn(\n        '[Reanimated] useAnimatedKeyboard is not available when using Jest.'\n      );\n    } else if (isChromeDebugger()) {\n      console.warn(\n        '[Reanimated] useAnimatedKeyboard is not available when using Chrome Debugger.'\n      );\n    } else {\n      console.warn(\n        '[Reanimated] useAnimatedKeyboard is not available on this configuration.'\n      );\n    }\n    return -1;\n  }\n\n  unsubscribeFromKeyboardEvents(_: number): void {\n    // noop\n  }\n\n  initializeSensor(sensorType: SensorType, interval: number): WebSensor {\n    const config =\n      interval <= 0\n        ? { referenceFrame: 'device' }\n        : { frequency: 1000 / interval };\n    switch (sensorType) {\n      case SensorType.ACCELEROMETER:\n        return new window.Accelerometer(config);\n      case SensorType.GYROSCOPE:\n        return new window.Gyroscope(config);\n      case SensorType.GRAVITY:\n        return new window.GravitySensor(config);\n      case SensorType.MAGNETIC_FIELD:\n        return new window.Magnetometer(config);\n      case SensorType.ROTATION:\n        return new window.AbsoluteOrientationSensor(config);\n    }\n  }\n\n  getSensorName(sensorType: SensorType): string {\n    switch (sensorType) {\n      case SensorType.ACCELEROMETER:\n        return 'Accelerometer';\n      case SensorType.GRAVITY:\n        return 'GravitySensor';\n      case SensorType.GYROSCOPE:\n        return 'Gyroscope';\n      case SensorType.MAGNETIC_FIELD:\n        return 'Magnetometer';\n      case SensorType.ROTATION:\n        return 'AbsoluteOrientationSensor';\n    }\n  }\n\n  detectPlatform() {\n    const userAgent = navigator.userAgent || navigator.vendor || window.opera;\n    if (userAgent === undefined) {\n      this.platform = Platform.UNKNOWN;\n    } else if (/iPad|iPhone|iPod/.test(userAgent)) {\n      this.platform = Platform.WEB_IOS;\n    } else if (/android/i.test(userAgent)) {\n      this.platform = Platform.WEB_ANDROID;\n    } else {\n      this.platform = Platform.WEB;\n    }\n  }\n\n  makeSynchronizedDataHolder<T>(\n    _valueRef: ShareableRef<T>\n  ): ShareableSyncDataHolderRef<T> {\n    throw new Error(\n      '[Reanimated] makeSynchronizedDataHolder is not available in JSReanimated.'\n    );\n  }\n\n  getDataSynchronously<T>(_ref: ShareableSyncDataHolderRef<T>): T {\n    throw new Error(\n      '[Reanimated] getDataSynchronously is not available in JSReanimated.'\n    );\n  }\n\n  getViewProp<T>(\n    _viewTag: number,\n    _propName: string,\n    _callback?: (result: T) => void\n  ): Promise<T> {\n    throw new Error(\n      '[Reanimated] getViewProp is not available in JSReanimated.'\n    );\n  }\n\n  configureProps() {\n    throw new Error(\n      '[Reanimated] configureProps is not available in JSReanimated.'\n    );\n  }\n}\n\nenum Platform {\n  WEB_IOS = 'web iOS',\n  WEB_ANDROID = 'web Android',\n  WEB = 'web',\n  UNKNOWN = 'unknown',\n}\n\ndeclare global {\n  interface Navigator {\n    userAgent?: string;\n    vendor?: string;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}