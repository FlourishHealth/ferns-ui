{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _objectSpread from\"@babel/runtime/helpers/objectSpread2\";import invariant from'fbjs/lib/invariant';var TaskQueue=function(){function TaskQueue(_ref){_classCallCheck(this,TaskQueue);var onMoreTasks=_ref.onMoreTasks;this._onMoreTasks=onMoreTasks;this._queueStack=[{tasks:[],popable:true}];}_createClass(TaskQueue,[{key:\"enqueue\",value:function enqueue(task){this._getCurrentQueue().push(task);}},{key:\"enqueueTasks\",value:function enqueueTasks(tasks){var _this=this;tasks.forEach(function(task){return _this.enqueue(task);});}},{key:\"cancelTasks\",value:function cancelTasks(tasksToCancel){this._queueStack=this._queueStack.map(function(queue){return _objectSpread(_objectSpread({},queue),{},{tasks:queue.tasks.filter(function(task){return tasksToCancel.indexOf(task)===-1;})});}).filter(function(queue,idx){return queue.tasks.length>0||idx===0;});}},{key:\"hasTasksToProcess\",value:function hasTasksToProcess(){return this._getCurrentQueue().length>0;}},{key:\"processNext\",value:function processNext(){var queue=this._getCurrentQueue();if(queue.length){var task=queue.shift();try{if(typeof task==='object'&&task.gen){this._genPromise(task);}else if(typeof task==='object'&&task.run){task.run();}else{invariant(typeof task==='function','Expected Function, SimpleTask, or PromiseTask, but got:\\n'+JSON.stringify(task,null,2));task();}}catch(e){e.message='TaskQueue: Error with task '+(task.name||'')+': '+e.message;throw e;}}}},{key:\"_getCurrentQueue\",value:function _getCurrentQueue(){var stackIdx=this._queueStack.length-1;var queue=this._queueStack[stackIdx];if(queue.popable&&queue.tasks.length===0&&stackIdx>0){this._queueStack.pop();return this._getCurrentQueue();}else{return queue.tasks;}}},{key:\"_genPromise\",value:function _genPromise(task){var _this2=this;var length=this._queueStack.push({tasks:[],popable:false});var stackIdx=length-1;var stackItem=this._queueStack[stackIdx];task.gen().then(function(){stackItem.popable=true;_this2.hasTasksToProcess()&&_this2._onMoreTasks();}).catch(function(ex){setTimeout(function(){ex.message=\"TaskQueue: Error resolving Promise in task \"+task.name+\": \"+ex.message;throw ex;},0);});}}]);return TaskQueue;}();export default TaskQueue;","map":{"version":3,"names":["_objectSpread","invariant","TaskQueue","_ref","_classCallCheck","onMoreTasks","_onMoreTasks","_queueStack","tasks","popable","_createClass","key","value","enqueue","task","_getCurrentQueue","push","enqueueTasks","_this","forEach","cancelTasks","tasksToCancel","map","queue","filter","indexOf","idx","length","hasTasksToProcess","processNext","shift","gen","_genPromise","run","JSON","stringify","e","message","name","stackIdx","pop","_this2","stackItem","then","catch","ex","setTimeout"],"sources":["/Users/josh/src/ui/node_modules/react-native-web/dist/exports/InteractionManager/TaskQueue.js"],"sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/objectSpread2\";\n/**\n * Copyright (c) Nicolas Gallagher.\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\n\nimport invariant from 'fbjs/lib/invariant';\nclass TaskQueue {\n  constructor(_ref) {\n    var onMoreTasks = _ref.onMoreTasks;\n    this._onMoreTasks = onMoreTasks;\n    this._queueStack = [{\n      tasks: [],\n      popable: true\n    }];\n  }\n  enqueue(task) {\n    this._getCurrentQueue().push(task);\n  }\n  enqueueTasks(tasks) {\n    tasks.forEach(task => this.enqueue(task));\n  }\n  cancelTasks(tasksToCancel) {\n    this._queueStack = this._queueStack.map(queue => _objectSpread(_objectSpread({}, queue), {}, {\n      tasks: queue.tasks.filter(task => tasksToCancel.indexOf(task) === -1)\n    })).filter((queue, idx) => queue.tasks.length > 0 || idx === 0);\n  }\n  hasTasksToProcess() {\n    return this._getCurrentQueue().length > 0;\n  }\n\n  /**\n   * Executes the next task in the queue.\n   */\n  processNext() {\n    var queue = this._getCurrentQueue();\n    if (queue.length) {\n      var task = queue.shift();\n      try {\n        if (typeof task === 'object' && task.gen) {\n          this._genPromise(task);\n        } else if (typeof task === 'object' && task.run) {\n          task.run();\n        } else {\n          invariant(typeof task === 'function', 'Expected Function, SimpleTask, or PromiseTask, but got:\\n' + JSON.stringify(task, null, 2));\n          task();\n        }\n      } catch (e) {\n        e.message = 'TaskQueue: Error with task ' + (task.name || '') + ': ' + e.message;\n        throw e;\n      }\n    }\n  }\n  _getCurrentQueue() {\n    var stackIdx = this._queueStack.length - 1;\n    var queue = this._queueStack[stackIdx];\n    if (queue.popable && queue.tasks.length === 0 && stackIdx > 0) {\n      this._queueStack.pop();\n      return this._getCurrentQueue();\n    } else {\n      return queue.tasks;\n    }\n  }\n  _genPromise(task) {\n    var length = this._queueStack.push({\n      tasks: [],\n      popable: false\n    });\n    var stackIdx = length - 1;\n    var stackItem = this._queueStack[stackIdx];\n    task.gen().then(() => {\n      stackItem.popable = true;\n      this.hasTasksToProcess() && this._onMoreTasks();\n    }).catch(ex => {\n      setTimeout(() => {\n        ex.message = \"TaskQueue: Error resolving Promise in task \" + task.name + \": \" + ex.message;\n        throw ex;\n      }, 0);\n    });\n  }\n}\nexport default TaskQueue;"],"mappings":"gIAAA,MAAO,CAAAA,aAAa,KAAM,sCAAsC,CAWhE,MAAO,CAAAC,SAAS,KAAM,oBAAoB,CAAC,GACrC,CAAAC,SAAS,YACb,SAAAA,UAAYC,IAAI,CAAE,CAAAC,eAAA,MAAAF,SAAA,EAChB,GAAI,CAAAG,WAAW,CAAGF,IAAI,CAACE,WAAW,CAClC,IAAI,CAACC,YAAY,CAAGD,WAAW,CAC/B,IAAI,CAACE,WAAW,CAAG,CAAC,CAClBC,KAAK,CAAE,EAAE,CACTC,OAAO,CAAE,IACX,CAAC,CAAC,CACJ,CAACC,YAAA,CAAAR,SAAA,GAAAS,GAAA,WAAAC,KAAA,CACD,SAAAC,QAAQC,IAAI,CAAE,CACZ,IAAI,CAACC,gBAAgB,CAAC,CAAC,CAACC,IAAI,CAACF,IAAI,CAAC,CACpC,CAAC,GAAAH,GAAA,gBAAAC,KAAA,CACD,SAAAK,aAAaT,KAAK,CAAE,KAAAU,KAAA,MAClBV,KAAK,CAACW,OAAO,CAAC,SAAAL,IAAI,QAAI,CAAAI,KAAI,CAACL,OAAO,CAACC,IAAI,CAAC,GAAC,CAC3C,CAAC,GAAAH,GAAA,eAAAC,KAAA,CACD,SAAAQ,YAAYC,aAAa,CAAE,CACzB,IAAI,CAACd,WAAW,CAAG,IAAI,CAACA,WAAW,CAACe,GAAG,CAAC,SAAAC,KAAK,QAAI,CAAAvB,aAAa,CAACA,aAAa,CAAC,CAAC,CAAC,CAAEuB,KAAK,CAAC,CAAE,CAAC,CAAC,CAAE,CAC3Ff,KAAK,CAAEe,KAAK,CAACf,KAAK,CAACgB,MAAM,CAAC,SAAAV,IAAI,QAAI,CAAAO,aAAa,CAACI,OAAO,CAACX,IAAI,CAAC,GAAK,CAAC,CAAC,GACtE,CAAC,CAAC,GAAC,CAACU,MAAM,CAAC,SAACD,KAAK,CAAEG,GAAG,QAAK,CAAAH,KAAK,CAACf,KAAK,CAACmB,MAAM,CAAG,CAAC,EAAID,GAAG,GAAK,CAAC,GAAC,CACjE,CAAC,GAAAf,GAAA,qBAAAC,KAAA,CACD,SAAAgB,kBAAA,CAAoB,CAClB,MAAO,KAAI,CAACb,gBAAgB,CAAC,CAAC,CAACY,MAAM,CAAG,CAAC,CAC3C,CAAC,GAAAhB,GAAA,eAAAC,KAAA,CAKD,SAAAiB,YAAA,CAAc,CACZ,GAAI,CAAAN,KAAK,CAAG,IAAI,CAACR,gBAAgB,CAAC,CAAC,CACnC,GAAIQ,KAAK,CAACI,MAAM,CAAE,CAChB,GAAI,CAAAb,IAAI,CAAGS,KAAK,CAACO,KAAK,CAAC,CAAC,CACxB,GAAI,CACF,GAAI,MAAO,CAAAhB,IAAI,GAAK,QAAQ,EAAIA,IAAI,CAACiB,GAAG,CAAE,CACxC,IAAI,CAACC,WAAW,CAAClB,IAAI,CAAC,CACxB,CAAC,IAAM,IAAI,MAAO,CAAAA,IAAI,GAAK,QAAQ,EAAIA,IAAI,CAACmB,GAAG,CAAE,CAC/CnB,IAAI,CAACmB,GAAG,CAAC,CAAC,CACZ,CAAC,IAAM,CACLhC,SAAS,CAAC,MAAO,CAAAa,IAAI,GAAK,UAAU,CAAE,2DAA2D,CAAGoB,IAAI,CAACC,SAAS,CAACrB,IAAI,CAAE,IAAI,CAAE,CAAC,CAAC,CAAC,CAClIA,IAAI,CAAC,CAAC,CACR,CACF,CAAE,MAAOsB,CAAC,CAAE,CACVA,CAAC,CAACC,OAAO,CAAG,6BAA6B,EAAIvB,IAAI,CAACwB,IAAI,EAAI,EAAE,CAAC,CAAG,IAAI,CAAGF,CAAC,CAACC,OAAO,CAChF,KAAM,CAAAD,CAAC,CACT,CACF,CACF,CAAC,GAAAzB,GAAA,oBAAAC,KAAA,CACD,SAAAG,iBAAA,CAAmB,CACjB,GAAI,CAAAwB,QAAQ,CAAG,IAAI,CAAChC,WAAW,CAACoB,MAAM,CAAG,CAAC,CAC1C,GAAI,CAAAJ,KAAK,CAAG,IAAI,CAAChB,WAAW,CAACgC,QAAQ,CAAC,CACtC,GAAIhB,KAAK,CAACd,OAAO,EAAIc,KAAK,CAACf,KAAK,CAACmB,MAAM,GAAK,CAAC,EAAIY,QAAQ,CAAG,CAAC,CAAE,CAC7D,IAAI,CAAChC,WAAW,CAACiC,GAAG,CAAC,CAAC,CACtB,MAAO,KAAI,CAACzB,gBAAgB,CAAC,CAAC,CAChC,CAAC,IAAM,CACL,MAAO,CAAAQ,KAAK,CAACf,KAAK,CACpB,CACF,CAAC,GAAAG,GAAA,eAAAC,KAAA,CACD,SAAAoB,YAAYlB,IAAI,CAAE,KAAA2B,MAAA,MAChB,GAAI,CAAAd,MAAM,CAAG,IAAI,CAACpB,WAAW,CAACS,IAAI,CAAC,CACjCR,KAAK,CAAE,EAAE,CACTC,OAAO,CAAE,KACX,CAAC,CAAC,CACF,GAAI,CAAA8B,QAAQ,CAAGZ,MAAM,CAAG,CAAC,CACzB,GAAI,CAAAe,SAAS,CAAG,IAAI,CAACnC,WAAW,CAACgC,QAAQ,CAAC,CAC1CzB,IAAI,CAACiB,GAAG,CAAC,CAAC,CAACY,IAAI,CAAC,UAAM,CACpBD,SAAS,CAACjC,OAAO,CAAG,IAAI,CACxBgC,MAAI,CAACb,iBAAiB,CAAC,CAAC,EAAIa,MAAI,CAACnC,YAAY,CAAC,CAAC,CACjD,CAAC,CAAC,CAACsC,KAAK,CAAC,SAAAC,EAAE,CAAI,CACbC,UAAU,CAAC,UAAM,CACfD,EAAE,CAACR,OAAO,CAAG,6CAA6C,CAAGvB,IAAI,CAACwB,IAAI,CAAG,IAAI,CAAGO,EAAE,CAACR,OAAO,CAC1F,KAAM,CAAAQ,EAAE,CACV,CAAC,CAAE,CAAC,CAAC,CACP,CAAC,CAAC,CACJ,CAAC,WAAA3C,SAAA,KAEH,cAAe,CAAAA,SAAS"},"metadata":{},"sourceType":"module"}