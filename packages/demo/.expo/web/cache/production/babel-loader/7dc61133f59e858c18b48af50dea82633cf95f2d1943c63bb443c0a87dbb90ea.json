{"ast":null,"code":"import{getContext}from'../utils/getContext.web';function resampleSingle(canvas,width,height){var resizeCanvas=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var result=document.createElement('canvas');result.width=canvas.width;result.height=canvas.height;var widthSource=canvas.width;var heightSource=canvas.height;width=Math.round(width);height=Math.round(height);var wRatio=widthSource/width;var hRatio=heightSource/height;var wRatioHalf=Math.ceil(wRatio/2);var hRatioHalf=Math.ceil(hRatio/2);var ctx=getContext(canvas);var img=ctx.getImageData(0,0,widthSource,heightSource);var img2=ctx.createImageData(width,height);var data=img.data;var data2=img2.data;for(var j=0;j<height;j++){for(var i=0;i<width;i++){var x2=(i+j*width)*4;var weight=0;var weights=0;var weightsAlpha=0;var gx_r=0;var gx_g=0;var gx_b=0;var gx_a=0;var yCenter=(j+0.5)*hRatio;var yy_start=Math.floor(j*hRatio);var yy_stop=Math.ceil((j+1)*hRatio);for(var yy=yy_start;yy<yy_stop;yy++){var dy=Math.abs(yCenter-(yy+0.5))/hRatioHalf;var center_x=(i+0.5)*wRatio;var w0=dy*dy;var xx_start=Math.floor(i*wRatio);var xx_stop=Math.ceil((i+1)*wRatio);for(var xx=xx_start;xx<xx_stop;xx++){var dx=Math.abs(center_x-(xx+0.5))/wRatioHalf;var w=Math.sqrt(w0+dx*dx);if(w>=1){continue;}weight=2*w*w*w-3*w*w+1;var xPosition=4*(xx+yy*widthSource);gx_a+=weight*data[xPosition+3];weightsAlpha+=weight;if(data[xPosition+3]<255){weight=weight*data[xPosition+3]/250;}gx_r+=weight*data[xPosition];gx_g+=weight*data[xPosition+1];gx_b+=weight*data[xPosition+2];weights+=weight;}}data2[x2]=gx_r/weights;data2[x2+1]=gx_g/weights;data2[x2+2]=gx_b/weights;data2[x2+3]=gx_a/weightsAlpha;}}if(resizeCanvas){result.width=width;result.height=height;}var context=getContext(result);context.putImageData(img2,0,0);return result;}export default(function(canvas,_ref){var width=_ref.width,height=_ref.height;var imageRatio=canvas.width/canvas.height;var requestedWidth=0;var requestedHeight=0;if(width!==undefined){requestedWidth=width;requestedHeight=requestedWidth/imageRatio;}if(height!==undefined){requestedHeight=height;if(requestedWidth===0){requestedWidth=requestedHeight*imageRatio;}}return resampleSingle(canvas,requestedWidth,requestedHeight,true);});","map":{"version":3,"names":["getContext","resampleSingle","canvas","width","height","resizeCanvas","arguments","length","undefined","result","document","createElement","widthSource","heightSource","Math","round","wRatio","hRatio","wRatioHalf","ceil","hRatioHalf","ctx","img","getImageData","img2","createImageData","data","data2","j","i","x2","weight","weights","weightsAlpha","gx_r","gx_g","gx_b","gx_a","yCenter","yy_start","floor","yy_stop","yy","dy","abs","center_x","w0","xx_start","xx_stop","xx","dx","w","sqrt","xPosition","context","putImageData","_ref","imageRatio","requestedWidth","requestedHeight"],"sources":["/Users/josh/src/ui/node_modules/expo-image-manipulator/src/actions/ResizeAction.web.ts"],"sourcesContent":["import { ActionResize } from '../ImageManipulator.types';\nimport { getContext } from '../utils/getContext.web';\n\n/**\n * Hermite resize - fast image resize/resample using Hermite filter. 1 cpu version!\n * https://stackoverflow.com/a/18320662/4047926\n *\n * @param {HTMLCanvasElement} canvas\n * @param {int} width\n * @param {int} height\n * @param {boolean} resizeCanvas if true, canvas will be resized. Optional.\n */\nfunction resampleSingle(\n  canvas: HTMLCanvasElement,\n  width: number,\n  height: number,\n  resizeCanvas: boolean = false\n): HTMLCanvasElement {\n  const result = document.createElement('canvas');\n  result.width = canvas.width;\n  result.height = canvas.height;\n\n  const widthSource = canvas.width;\n  const heightSource = canvas.height;\n  width = Math.round(width);\n  height = Math.round(height);\n\n  const wRatio = widthSource / width;\n  const hRatio = heightSource / height;\n  const wRatioHalf = Math.ceil(wRatio / 2);\n  const hRatioHalf = Math.ceil(hRatio / 2);\n\n  const ctx = getContext(canvas);\n\n  const img = ctx.getImageData(0, 0, widthSource, heightSource);\n  const img2 = ctx.createImageData(width, height);\n  const data = img.data;\n  const data2 = img2.data;\n\n  for (let j = 0; j < height; j++) {\n    for (let i = 0; i < width; i++) {\n      const x2 = (i + j * width) * 4;\n      let weight = 0;\n      let weights = 0;\n      let weightsAlpha = 0;\n      let gx_r = 0;\n      let gx_g = 0;\n      let gx_b = 0;\n      let gx_a = 0;\n      const yCenter = (j + 0.5) * hRatio;\n      const yy_start = Math.floor(j * hRatio);\n      const yy_stop = Math.ceil((j + 1) * hRatio);\n      for (let yy = yy_start; yy < yy_stop; yy++) {\n        const dy = Math.abs(yCenter - (yy + 0.5)) / hRatioHalf;\n        const center_x = (i + 0.5) * wRatio;\n        const w0 = dy * dy; //pre-calc part of w\n        const xx_start = Math.floor(i * wRatio);\n        const xx_stop = Math.ceil((i + 1) * wRatio);\n        for (let xx = xx_start; xx < xx_stop; xx++) {\n          const dx = Math.abs(center_x - (xx + 0.5)) / wRatioHalf;\n          const w = Math.sqrt(w0 + dx * dx);\n          if (w >= 1) {\n            //pixel too far\n            continue;\n          }\n          //hermite filter\n          weight = 2 * w * w * w - 3 * w * w + 1;\n          const xPosition = 4 * (xx + yy * widthSource);\n          //alpha\n          gx_a += weight * data[xPosition + 3];\n          weightsAlpha += weight;\n          //colors\n          if (data[xPosition + 3] < 255) {\n            weight = (weight * data[xPosition + 3]) / 250;\n          }\n          gx_r += weight * data[xPosition];\n          gx_g += weight * data[xPosition + 1];\n          gx_b += weight * data[xPosition + 2];\n          weights += weight;\n        }\n      }\n      data2[x2] = gx_r / weights;\n      data2[x2 + 1] = gx_g / weights;\n      data2[x2 + 2] = gx_b / weights;\n      data2[x2 + 3] = gx_a / weightsAlpha;\n    }\n  }\n\n  //resize canvas\n  if (resizeCanvas) {\n    result.width = width;\n    result.height = height;\n  }\n\n  //draw\n  const context = getContext(result);\n  context.putImageData(img2, 0, 0);\n\n  return result;\n}\n\nexport default (canvas: HTMLCanvasElement, { width, height }: ActionResize['resize']) => {\n  const imageRatio = canvas.width / canvas.height;\n\n  let requestedWidth: number = 0;\n  let requestedHeight: number = 0;\n  if (width !== undefined) {\n    requestedWidth = width;\n    requestedHeight = requestedWidth / imageRatio;\n  }\n  if (height !== undefined) {\n    requestedHeight = height;\n    if (requestedWidth === 0) {\n      requestedWidth = requestedHeight * imageRatio;\n    }\n  }\n\n  return resampleSingle(canvas, requestedWidth, requestedHeight, true);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}