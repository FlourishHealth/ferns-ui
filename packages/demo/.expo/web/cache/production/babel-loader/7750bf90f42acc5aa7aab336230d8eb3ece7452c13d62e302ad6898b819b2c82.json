{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import{EventTypes,MouseButtons,PointerType,TouchEventType}from'../interfaces';import EventManager from'./EventManager';import{isPointerInBounds}from'../utils';var TouchEventManager=function(_EventManager){_inherits(TouchEventManager,_EventManager);var _super=_createSuper(TouchEventManager);function TouchEventManager(){_classCallCheck(this,TouchEventManager);return _super.apply(this,arguments);}_createClass(TouchEventManager,[{key:\"setListeners\",value:function setListeners(){var _this=this;this.view.addEventListener('touchstart',function(event){for(var i=0;i<event.changedTouches.length;++i){var adaptedEvent=_this.mapEvent(event,EventTypes.DOWN,i,TouchEventType.DOWN);if(!isPointerInBounds(_this.view,{x:adaptedEvent.x,y:adaptedEvent.y})||event.changedTouches[i].touchType==='stylus'){continue;}_this.markAsInBounds(adaptedEvent.pointerId);if(++_this.activePointersCounter>1){adaptedEvent.eventType=EventTypes.ADDITIONAL_POINTER_DOWN;_this.onPointerAdd(adaptedEvent);}else{_this.onPointerDown(adaptedEvent);}}});this.view.addEventListener('touchmove',function(event){for(var i=0;i<event.changedTouches.length;++i){var adaptedEvent=_this.mapEvent(event,EventTypes.MOVE,i,TouchEventType.MOVE);if(event.changedTouches[i].touchType==='stylus'){continue;}var inBounds=isPointerInBounds(_this.view,{x:adaptedEvent.x,y:adaptedEvent.y});var pointerIndex=_this.pointersInBounds.indexOf(adaptedEvent.pointerId);if(inBounds){if(pointerIndex<0){adaptedEvent.eventType=EventTypes.ENTER;_this.onPointerEnter(adaptedEvent);_this.markAsInBounds(adaptedEvent.pointerId);}else{_this.onPointerMove(adaptedEvent);}}else{if(pointerIndex>=0){adaptedEvent.eventType=EventTypes.LEAVE;_this.onPointerLeave(adaptedEvent);_this.markAsOutOfBounds(adaptedEvent.pointerId);}else{_this.onPointerOutOfBounds(adaptedEvent);}}}});this.view.addEventListener('touchend',function(event){for(var i=0;i<event.changedTouches.length;++i){if(_this.activePointersCounter===0){break;}if(event.changedTouches[i].touchType==='stylus'){continue;}var adaptedEvent=_this.mapEvent(event,EventTypes.UP,i,TouchEventType.UP);_this.markAsOutOfBounds(adaptedEvent.pointerId);if(--_this.activePointersCounter>0){adaptedEvent.eventType=EventTypes.ADDITIONAL_POINTER_UP;_this.onPointerRemove(adaptedEvent);}else{_this.onPointerUp(adaptedEvent);}}});this.view.addEventListener('touchcancel',function(event){for(var i=0;i<event.changedTouches.length;++i){var adaptedEvent=_this.mapEvent(event,EventTypes.CANCEL,i,TouchEventType.CANCELLED);if(event.changedTouches[i].touchType==='stylus'){continue;}_this.onPointerCancel(adaptedEvent);_this.markAsOutOfBounds(adaptedEvent.pointerId);_this.activePointersCounter=0;}});}},{key:\"mapEvent\",value:function mapEvent(event,eventType,index,touchEventType){var rect=this.view.getBoundingClientRect();var clientX=event.changedTouches[index].clientX;var clientY=event.changedTouches[index].clientY;return{x:clientX,y:clientY,offsetX:clientX-rect.left,offsetY:clientY-rect.top,pointerId:event.changedTouches[index].identifier,eventType:eventType,pointerType:PointerType.TOUCH,buttons:MouseButtons.NONE,time:event.timeStamp,allTouches:event.touches,changedTouches:event.changedTouches,touchEventType:touchEventType};}}]);return TouchEventManager;}(EventManager);export{TouchEventManager as default};","map":{"version":3,"names":["EventTypes","MouseButtons","PointerType","TouchEventType","EventManager","isPointerInBounds","TouchEventManager","_EventManager","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","setListeners","_this","view","addEventListener","event","i","changedTouches","length","adaptedEvent","mapEvent","DOWN","x","y","touchType","markAsInBounds","pointerId","activePointersCounter","eventType","ADDITIONAL_POINTER_DOWN","onPointerAdd","onPointerDown","MOVE","inBounds","pointerIndex","pointersInBounds","indexOf","ENTER","onPointerEnter","onPointerMove","LEAVE","onPointerLeave","markAsOutOfBounds","onPointerOutOfBounds","UP","ADDITIONAL_POINTER_UP","onPointerRemove","onPointerUp","CANCEL","CANCELLED","onPointerCancel","index","touchEventType","rect","getBoundingClientRect","clientX","clientY","offsetX","left","offsetY","top","identifier","pointerType","TOUCH","buttons","NONE","time","timeStamp","allTouches","touches","default"],"sources":["/Users/josh/src/ui/node_modules/react-native-gesture-handler/lib/module/web/tools/TouchEventManager.ts"],"sourcesContent":["import {\n  AdaptedEvent,\n  EventTypes,\n  MouseButtons,\n  PointerType,\n  TouchEventType,\n} from '../interfaces';\nimport EventManager from './EventManager';\nimport { isPointerInBounds } from '../utils';\n\nexport default class TouchEventManager extends EventManager<HTMLElement> {\n  public setListeners(): void {\n    this.view.addEventListener('touchstart', (event: TouchEvent) => {\n      for (let i = 0; i < event.changedTouches.length; ++i) {\n        const adaptedEvent: AdaptedEvent = this.mapEvent(\n          event,\n          EventTypes.DOWN,\n          i,\n          TouchEventType.DOWN\n        );\n\n        // Here we skip stylus, because in case of anything different than touch we want to handle it by using PointerEvents\n        // If we leave stylus to send touch events, handlers will receive every action twice\n        if (\n          !isPointerInBounds(this.view, {\n            x: adaptedEvent.x,\n            y: adaptedEvent.y,\n          }) ||\n          //@ts-ignore touchType field does exist\n          event.changedTouches[i].touchType === 'stylus'\n        ) {\n          continue;\n        }\n\n        this.markAsInBounds(adaptedEvent.pointerId);\n\n        if (++this.activePointersCounter > 1) {\n          adaptedEvent.eventType = EventTypes.ADDITIONAL_POINTER_DOWN;\n          this.onPointerAdd(adaptedEvent);\n        } else {\n          this.onPointerDown(adaptedEvent);\n        }\n      }\n    });\n\n    this.view.addEventListener('touchmove', (event: TouchEvent) => {\n      for (let i = 0; i < event.changedTouches.length; ++i) {\n        const adaptedEvent: AdaptedEvent = this.mapEvent(\n          event,\n          EventTypes.MOVE,\n          i,\n          TouchEventType.MOVE\n        );\n        //@ts-ignore touchType field does exist\n        if (event.changedTouches[i].touchType === 'stylus') {\n          continue;\n        }\n\n        const inBounds: boolean = isPointerInBounds(this.view, {\n          x: adaptedEvent.x,\n          y: adaptedEvent.y,\n        });\n\n        const pointerIndex: number = this.pointersInBounds.indexOf(\n          adaptedEvent.pointerId\n        );\n\n        if (inBounds) {\n          if (pointerIndex < 0) {\n            adaptedEvent.eventType = EventTypes.ENTER;\n            this.onPointerEnter(adaptedEvent);\n            this.markAsInBounds(adaptedEvent.pointerId);\n          } else {\n            this.onPointerMove(adaptedEvent);\n          }\n        } else {\n          if (pointerIndex >= 0) {\n            adaptedEvent.eventType = EventTypes.LEAVE;\n            this.onPointerLeave(adaptedEvent);\n            this.markAsOutOfBounds(adaptedEvent.pointerId);\n          } else {\n            this.onPointerOutOfBounds(adaptedEvent);\n          }\n        }\n      }\n    });\n\n    this.view.addEventListener('touchend', (event: TouchEvent) => {\n      for (let i = 0; i < event.changedTouches.length; ++i) {\n        // When we call reset on gesture handlers, it also resets their event managers\n        // In some handlers (like RotationGestureHandler) reset is called before all pointers leave view\n        // This means, that activePointersCounter will be set to 0, while there are still remaining pointers on view\n        // Removing them will end in activePointersCounter going below 0, therefore handlers won't behave properly\n        if (this.activePointersCounter === 0) {\n          break;\n        }\n\n        //@ts-ignore touchType field does exist\n        if (event.changedTouches[i].touchType === 'stylus') {\n          continue;\n        }\n\n        const adaptedEvent: AdaptedEvent = this.mapEvent(\n          event,\n          EventTypes.UP,\n          i,\n          TouchEventType.UP\n        );\n\n        this.markAsOutOfBounds(adaptedEvent.pointerId);\n\n        if (--this.activePointersCounter > 0) {\n          adaptedEvent.eventType = EventTypes.ADDITIONAL_POINTER_UP;\n          this.onPointerRemove(adaptedEvent);\n        } else {\n          this.onPointerUp(adaptedEvent);\n        }\n      }\n    });\n\n    this.view.addEventListener('touchcancel', (event: TouchEvent) => {\n      for (let i = 0; i < event.changedTouches.length; ++i) {\n        const adaptedEvent: AdaptedEvent = this.mapEvent(\n          event,\n          EventTypes.CANCEL,\n          i,\n          TouchEventType.CANCELLED\n        );\n\n        //@ts-ignore touchType field does exist\n        if (event.changedTouches[i].touchType === 'stylus') {\n          continue;\n        }\n\n        this.onPointerCancel(adaptedEvent);\n        this.markAsOutOfBounds(adaptedEvent.pointerId);\n        this.activePointersCounter = 0;\n      }\n    });\n  }\n\n  protected mapEvent(\n    event: TouchEvent,\n    eventType: EventTypes,\n    index: number,\n    touchEventType: TouchEventType\n  ): AdaptedEvent {\n    const rect = this.view.getBoundingClientRect();\n    const clientX = event.changedTouches[index].clientX;\n    const clientY = event.changedTouches[index].clientY;\n\n    return {\n      x: clientX,\n      y: clientY,\n      offsetX: clientX - rect.left,\n      offsetY: clientY - rect.top,\n      pointerId: event.changedTouches[index].identifier,\n      eventType: eventType,\n      pointerType: PointerType.TOUCH,\n      buttons: MouseButtons.NONE,\n      time: event.timeStamp,\n      allTouches: event.touches,\n      changedTouches: event.changedTouches,\n      touchEventType: touchEventType,\n    };\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}