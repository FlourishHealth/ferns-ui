{"ast":null,"code":"import{addEventListener}from'../addEventListener';import canUseDOM from'../canUseDom';var supportsPointerEvent=function supportsPointerEvent(){return!!(typeof window!=='undefined'&&window.PointerEvent!=null);};var activeModality='keyboard';var modality='keyboard';var previousModality;var previousActiveModality;var isEmulatingMouseEvents=false;var listeners=new Set();var KEYBOARD='keyboard';var MOUSE='mouse';var TOUCH='touch';var BLUR='blur';var CONTEXTMENU='contextmenu';var FOCUS='focus';var KEYDOWN='keydown';var MOUSEDOWN='mousedown';var MOUSEMOVE='mousemove';var MOUSEUP='mouseup';var POINTERDOWN='pointerdown';var POINTERMOVE='pointermove';var SCROLL='scroll';var SELECTIONCHANGE='selectionchange';var TOUCHCANCEL='touchcancel';var TOUCHMOVE='touchmove';var TOUCHSTART='touchstart';var VISIBILITYCHANGE='visibilitychange';var bubbleOptions={passive:true};var captureOptions={capture:true,passive:true};function restoreModality(){if(previousModality!=null||previousActiveModality!=null){if(previousModality!=null){modality=previousModality;previousModality=null;}if(previousActiveModality!=null){activeModality=previousActiveModality;previousActiveModality=null;}callListeners();}}function onBlurWindow(){previousModality=modality;previousActiveModality=activeModality;activeModality=KEYBOARD;modality=KEYBOARD;callListeners();isEmulatingMouseEvents=false;}function onFocusWindow(){restoreModality();}function onKeyDown(event){if(event.metaKey||event.altKey||event.ctrlKey){return;}if(modality!==KEYBOARD){modality=KEYBOARD;activeModality=KEYBOARD;callListeners();}}function onVisibilityChange(){if(document.visibilityState!=='hidden'){restoreModality();}}function onPointerish(event){var eventType=event.type;if(supportsPointerEvent()){if(eventType===POINTERDOWN){if(activeModality!==event.pointerType){modality=event.pointerType;activeModality=event.pointerType;callListeners();}return;}if(eventType===POINTERMOVE){if(modality!==event.pointerType){modality=event.pointerType;callListeners();}return;}}else{if(!isEmulatingMouseEvents){if(eventType===MOUSEDOWN){if(activeModality!==MOUSE){modality=MOUSE;activeModality=MOUSE;callListeners();}}if(eventType===MOUSEMOVE){if(modality!==MOUSE){modality=MOUSE;callListeners();}}}if(eventType===TOUCHSTART){isEmulatingMouseEvents=true;if(event.touches&&event.touches.length>1){isEmulatingMouseEvents=false;}if(activeModality!==TOUCH){modality=TOUCH;activeModality=TOUCH;callListeners();}return;}if(eventType===CONTEXTMENU||eventType===MOUSEUP||eventType===SELECTIONCHANGE||eventType===SCROLL||eventType===TOUCHCANCEL||eventType===TOUCHMOVE){isEmulatingMouseEvents=false;}}}if(canUseDOM){addEventListener(window,BLUR,onBlurWindow,bubbleOptions);addEventListener(window,FOCUS,onFocusWindow,bubbleOptions);addEventListener(document,KEYDOWN,onKeyDown,captureOptions);addEventListener(document,VISIBILITYCHANGE,onVisibilityChange,captureOptions);addEventListener(document,POINTERDOWN,onPointerish,captureOptions);addEventListener(document,POINTERMOVE,onPointerish,captureOptions);addEventListener(document,CONTEXTMENU,onPointerish,captureOptions);addEventListener(document,MOUSEDOWN,onPointerish,captureOptions);addEventListener(document,MOUSEMOVE,onPointerish,captureOptions);addEventListener(document,MOUSEUP,onPointerish,captureOptions);addEventListener(document,TOUCHCANCEL,onPointerish,captureOptions);addEventListener(document,TOUCHMOVE,onPointerish,captureOptions);addEventListener(document,TOUCHSTART,onPointerish,captureOptions);addEventListener(document,SELECTIONCHANGE,onPointerish,captureOptions);addEventListener(document,SCROLL,onPointerish,captureOptions);}function callListeners(){var value={activeModality:activeModality,modality:modality};listeners.forEach(function(listener){listener(value);});}export function getActiveModality(){return activeModality;}export function getModality(){return modality;}export function addModalityListener(listener){listeners.add(listener);return function(){listeners.delete(listener);};}export function testOnly_resetActiveModality(){isEmulatingMouseEvents=false;activeModality=KEYBOARD;modality=KEYBOARD;}","map":{"version":3,"names":["addEventListener","canUseDOM","supportsPointerEvent","window","PointerEvent","activeModality","modality","previousModality","previousActiveModality","isEmulatingMouseEvents","listeners","Set","KEYBOARD","MOUSE","TOUCH","BLUR","CONTEXTMENU","FOCUS","KEYDOWN","MOUSEDOWN","MOUSEMOVE","MOUSEUP","POINTERDOWN","POINTERMOVE","SCROLL","SELECTIONCHANGE","TOUCHCANCEL","TOUCHMOVE","TOUCHSTART","VISIBILITYCHANGE","bubbleOptions","passive","captureOptions","capture","restoreModality","callListeners","onBlurWindow","onFocusWindow","onKeyDown","event","metaKey","altKey","ctrlKey","onVisibilityChange","document","visibilityState","onPointerish","eventType","type","pointerType","touches","length","value","forEach","listener","getActiveModality","getModality","addModalityListener","add","delete","testOnly_resetActiveModality"],"sources":["/Users/josh/src/ui/node_modules/react-native-web/dist/modules/modality/index.js"],"sourcesContent":["/**\n * Copyright (c) Nicolas Gallagher.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\n\nimport { addEventListener } from '../addEventListener';\nimport canUseDOM from '../canUseDom';\nvar supportsPointerEvent = () => !!(typeof window !== 'undefined' && window.PointerEvent != null);\nvar activeModality = 'keyboard';\nvar modality = 'keyboard';\nvar previousModality;\nvar previousActiveModality;\nvar isEmulatingMouseEvents = false;\nvar listeners = new Set();\nvar KEYBOARD = 'keyboard';\nvar MOUSE = 'mouse';\nvar TOUCH = 'touch';\nvar BLUR = 'blur';\nvar CONTEXTMENU = 'contextmenu';\nvar FOCUS = 'focus';\nvar KEYDOWN = 'keydown';\nvar MOUSEDOWN = 'mousedown';\nvar MOUSEMOVE = 'mousemove';\nvar MOUSEUP = 'mouseup';\nvar POINTERDOWN = 'pointerdown';\nvar POINTERMOVE = 'pointermove';\nvar SCROLL = 'scroll';\nvar SELECTIONCHANGE = 'selectionchange';\nvar TOUCHCANCEL = 'touchcancel';\nvar TOUCHMOVE = 'touchmove';\nvar TOUCHSTART = 'touchstart';\nvar VISIBILITYCHANGE = 'visibilitychange';\nvar bubbleOptions = {\n  passive: true\n};\nvar captureOptions = {\n  capture: true,\n  passive: true\n};\nfunction restoreModality() {\n  if (previousModality != null || previousActiveModality != null) {\n    if (previousModality != null) {\n      modality = previousModality;\n      previousModality = null;\n    }\n    if (previousActiveModality != null) {\n      activeModality = previousActiveModality;\n      previousActiveModality = null;\n    }\n    callListeners();\n  }\n}\nfunction onBlurWindow() {\n  previousModality = modality;\n  previousActiveModality = activeModality;\n  activeModality = KEYBOARD;\n  modality = KEYBOARD;\n  callListeners();\n  // for fallback events\n  isEmulatingMouseEvents = false;\n}\nfunction onFocusWindow() {\n  restoreModality();\n}\nfunction onKeyDown(event) {\n  if (event.metaKey || event.altKey || event.ctrlKey) {\n    return;\n  }\n  if (modality !== KEYBOARD) {\n    modality = KEYBOARD;\n    activeModality = KEYBOARD;\n    callListeners();\n  }\n}\nfunction onVisibilityChange() {\n  if (document.visibilityState !== 'hidden') {\n    restoreModality();\n  }\n}\nfunction onPointerish(event) {\n  var eventType = event.type;\n  if (supportsPointerEvent()) {\n    if (eventType === POINTERDOWN) {\n      if (activeModality !== event.pointerType) {\n        modality = event.pointerType;\n        activeModality = event.pointerType;\n        callListeners();\n      }\n      return;\n    }\n    if (eventType === POINTERMOVE) {\n      if (modality !== event.pointerType) {\n        modality = event.pointerType;\n        callListeners();\n      }\n      return;\n    }\n  }\n  // Fallback for non-PointerEvent environment\n  else {\n    if (!isEmulatingMouseEvents) {\n      if (eventType === MOUSEDOWN) {\n        if (activeModality !== MOUSE) {\n          modality = MOUSE;\n          activeModality = MOUSE;\n          callListeners();\n        }\n      }\n      if (eventType === MOUSEMOVE) {\n        if (modality !== MOUSE) {\n          modality = MOUSE;\n          callListeners();\n        }\n      }\n    }\n\n    // Flag when browser may produce emulated events\n    if (eventType === TOUCHSTART) {\n      isEmulatingMouseEvents = true;\n      if (event.touches && event.touches.length > 1) {\n        isEmulatingMouseEvents = false;\n      }\n      if (activeModality !== TOUCH) {\n        modality = TOUCH;\n        activeModality = TOUCH;\n        callListeners();\n      }\n      return;\n    }\n\n    // Remove flag after emulated events are finished or cancelled, and if an\n    // event occurs that cuts short a touch event sequence.\n    if (eventType === CONTEXTMENU || eventType === MOUSEUP || eventType === SELECTIONCHANGE || eventType === SCROLL || eventType === TOUCHCANCEL || eventType === TOUCHMOVE) {\n      isEmulatingMouseEvents = false;\n    }\n  }\n}\nif (canUseDOM) {\n  // Window events\n  addEventListener(window, BLUR, onBlurWindow, bubbleOptions);\n  addEventListener(window, FOCUS, onFocusWindow, bubbleOptions);\n  // Must be capture phase because 'stopPropagation' might prevent these\n  // events bubbling to the document.\n  addEventListener(document, KEYDOWN, onKeyDown, captureOptions);\n  addEventListener(document, VISIBILITYCHANGE, onVisibilityChange, captureOptions);\n  addEventListener(document, POINTERDOWN, onPointerish, captureOptions);\n  addEventListener(document, POINTERMOVE, onPointerish, captureOptions);\n  // Fallback events\n  addEventListener(document, CONTEXTMENU, onPointerish, captureOptions);\n  addEventListener(document, MOUSEDOWN, onPointerish, captureOptions);\n  addEventListener(document, MOUSEMOVE, onPointerish, captureOptions);\n  addEventListener(document, MOUSEUP, onPointerish, captureOptions);\n  addEventListener(document, TOUCHCANCEL, onPointerish, captureOptions);\n  addEventListener(document, TOUCHMOVE, onPointerish, captureOptions);\n  addEventListener(document, TOUCHSTART, onPointerish, captureOptions);\n  addEventListener(document, SELECTIONCHANGE, onPointerish, captureOptions);\n  addEventListener(document, SCROLL, onPointerish, captureOptions);\n}\nfunction callListeners() {\n  var value = {\n    activeModality,\n    modality\n  };\n  listeners.forEach(listener => {\n    listener(value);\n  });\n}\nexport function getActiveModality() {\n  return activeModality;\n}\nexport function getModality() {\n  return modality;\n}\nexport function addModalityListener(listener) {\n  listeners.add(listener);\n  return () => {\n    listeners.delete(listener);\n  };\n}\nexport function testOnly_resetActiveModality() {\n  isEmulatingMouseEvents = false;\n  activeModality = KEYBOARD;\n  modality = KEYBOARD;\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}