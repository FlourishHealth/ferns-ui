{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";var dataUriPattern=/^data:/;export var ImageUriCache=function(){function ImageUriCache(){_classCallCheck(this,ImageUriCache);}_createClass(ImageUriCache,null,[{key:\"has\",value:function has(uri){var entries=ImageUriCache._entries;var isDataUri=dataUriPattern.test(uri);return isDataUri||Boolean(entries[uri]);}},{key:\"add\",value:function add(uri){var entries=ImageUriCache._entries;var lastUsedTimestamp=Date.now();if(entries[uri]){entries[uri].lastUsedTimestamp=lastUsedTimestamp;entries[uri].refCount+=1;}else{entries[uri]={lastUsedTimestamp:lastUsedTimestamp,refCount:1};}}},{key:\"remove\",value:function remove(uri){var entries=ImageUriCache._entries;if(entries[uri]){entries[uri].refCount-=1;}ImageUriCache._cleanUpIfNeeded();}},{key:\"_cleanUpIfNeeded\",value:function _cleanUpIfNeeded(){var entries=ImageUriCache._entries;var imageUris=Object.keys(entries);if(imageUris.length+1>ImageUriCache._maximumEntries){var leastRecentlyUsedKey;var leastRecentlyUsedEntry;imageUris.forEach(function(uri){var entry=entries[uri];if((!leastRecentlyUsedEntry||entry.lastUsedTimestamp<leastRecentlyUsedEntry.lastUsedTimestamp)&&entry.refCount===0){leastRecentlyUsedKey=uri;leastRecentlyUsedEntry=entry;}});if(leastRecentlyUsedKey){delete entries[leastRecentlyUsedKey];}}}}]);return ImageUriCache;}();ImageUriCache._maximumEntries=256;ImageUriCache._entries={};var id=0;var requests={};var ImageLoader={abort:function abort(requestId){var image=requests[\"\"+requestId];if(image){image.onerror=null;image.onload=null;image=null;delete requests[\"\"+requestId];}},getSize:function getSize(uri,success,failure){var complete=false;var interval=setInterval(callback,16);var requestId=ImageLoader.load(uri,callback,errorCallback);function callback(){var image=requests[\"\"+requestId];if(image){var naturalHeight=image.naturalHeight,naturalWidth=image.naturalWidth;if(naturalHeight&&naturalWidth){success(naturalWidth,naturalHeight);complete=true;}}if(complete){ImageLoader.abort(requestId);clearInterval(interval);}}function errorCallback(){if(typeof failure==='function'){failure();}ImageLoader.abort(requestId);clearInterval(interval);}},has:function has(uri){return ImageUriCache.has(uri);},load:function load(uri,onLoad,onError){id+=1;var image=new window.Image();image.onerror=onError;image.onload=function(e){var onDecode=function onDecode(){return onLoad({nativeEvent:e});};if(typeof image.decode==='function'){image.decode().then(onDecode,onDecode);}else{setTimeout(onDecode,0);}};image.src=uri;requests[\"\"+id]=image;return id;},prefetch:function prefetch(uri){return new Promise(function(resolve,reject){ImageLoader.load(uri,function(){ImageUriCache.add(uri);ImageUriCache.remove(uri);resolve();},reject);});},queryCache:function queryCache(uris){var result={};uris.forEach(function(u){if(ImageUriCache.has(u)){result[u]='disk/memory';}});return Promise.resolve(result);}};export default ImageLoader;","map":{"version":3,"names":["dataUriPattern","ImageUriCache","_classCallCheck","_createClass","key","value","has","uri","entries","_entries","isDataUri","test","Boolean","add","lastUsedTimestamp","Date","now","refCount","remove","_cleanUpIfNeeded","imageUris","Object","keys","length","_maximumEntries","leastRecentlyUsedKey","leastRecentlyUsedEntry","forEach","entry","id","requests","ImageLoader","abort","requestId","image","onerror","onload","getSize","success","failure","complete","interval","setInterval","callback","load","errorCallback","naturalHeight","naturalWidth","clearInterval","onLoad","onError","window","Image","e","onDecode","nativeEvent","decode","then","setTimeout","src","prefetch","Promise","resolve","reject","queryCache","uris","result","u"],"sources":["/Users/josh/src/ui/node_modules/react-native-web/dist/modules/ImageLoader/index.js"],"sourcesContent":["/**\n * Copyright (c) Nicolas Gallagher.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n */\n\nvar dataUriPattern = /^data:/;\nexport class ImageUriCache {\n  static has(uri) {\n    var entries = ImageUriCache._entries;\n    var isDataUri = dataUriPattern.test(uri);\n    return isDataUri || Boolean(entries[uri]);\n  }\n  static add(uri) {\n    var entries = ImageUriCache._entries;\n    var lastUsedTimestamp = Date.now();\n    if (entries[uri]) {\n      entries[uri].lastUsedTimestamp = lastUsedTimestamp;\n      entries[uri].refCount += 1;\n    } else {\n      entries[uri] = {\n        lastUsedTimestamp,\n        refCount: 1\n      };\n    }\n  }\n  static remove(uri) {\n    var entries = ImageUriCache._entries;\n    if (entries[uri]) {\n      entries[uri].refCount -= 1;\n    }\n    // Free up entries when the cache is \"full\"\n    ImageUriCache._cleanUpIfNeeded();\n  }\n  static _cleanUpIfNeeded() {\n    var entries = ImageUriCache._entries;\n    var imageUris = Object.keys(entries);\n    if (imageUris.length + 1 > ImageUriCache._maximumEntries) {\n      var leastRecentlyUsedKey;\n      var leastRecentlyUsedEntry;\n      imageUris.forEach(uri => {\n        var entry = entries[uri];\n        if ((!leastRecentlyUsedEntry || entry.lastUsedTimestamp < leastRecentlyUsedEntry.lastUsedTimestamp) && entry.refCount === 0) {\n          leastRecentlyUsedKey = uri;\n          leastRecentlyUsedEntry = entry;\n        }\n      });\n      if (leastRecentlyUsedKey) {\n        delete entries[leastRecentlyUsedKey];\n      }\n    }\n  }\n}\nImageUriCache._maximumEntries = 256;\nImageUriCache._entries = {};\nvar id = 0;\nvar requests = {};\nvar ImageLoader = {\n  abort(requestId) {\n    var image = requests[\"\" + requestId];\n    if (image) {\n      image.onerror = null;\n      image.onload = null;\n      image = null;\n      delete requests[\"\" + requestId];\n    }\n  },\n  getSize(uri, success, failure) {\n    var complete = false;\n    var interval = setInterval(callback, 16);\n    var requestId = ImageLoader.load(uri, callback, errorCallback);\n    function callback() {\n      var image = requests[\"\" + requestId];\n      if (image) {\n        var naturalHeight = image.naturalHeight,\n          naturalWidth = image.naturalWidth;\n        if (naturalHeight && naturalWidth) {\n          success(naturalWidth, naturalHeight);\n          complete = true;\n        }\n      }\n      if (complete) {\n        ImageLoader.abort(requestId);\n        clearInterval(interval);\n      }\n    }\n    function errorCallback() {\n      if (typeof failure === 'function') {\n        failure();\n      }\n      ImageLoader.abort(requestId);\n      clearInterval(interval);\n    }\n  },\n  has(uri) {\n    return ImageUriCache.has(uri);\n  },\n  load(uri, onLoad, onError) {\n    id += 1;\n    var image = new window.Image();\n    image.onerror = onError;\n    image.onload = e => {\n      // avoid blocking the main thread\n      var onDecode = () => onLoad({\n        nativeEvent: e\n      });\n      if (typeof image.decode === 'function') {\n        // Safari currently throws exceptions when decoding svgs.\n        // We want to catch that error and allow the load handler\n        // to be forwarded to the onLoad handler in this case\n        image.decode().then(onDecode, onDecode);\n      } else {\n        setTimeout(onDecode, 0);\n      }\n    };\n    image.src = uri;\n    requests[\"\" + id] = image;\n    return id;\n  },\n  prefetch(uri) {\n    return new Promise((resolve, reject) => {\n      ImageLoader.load(uri, () => {\n        // Add the uri to the cache so it can be immediately displayed when used\n        // but also immediately remove it to correctly reflect that it has no active references\n        ImageUriCache.add(uri);\n        ImageUriCache.remove(uri);\n        resolve();\n      }, reject);\n    });\n  },\n  queryCache(uris) {\n    var result = {};\n    uris.forEach(u => {\n      if (ImageUriCache.has(u)) {\n        result[u] = 'disk/memory';\n      }\n    });\n    return Promise.resolve(result);\n  }\n};\nexport default ImageLoader;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}